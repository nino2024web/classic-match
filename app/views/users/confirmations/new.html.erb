<% content_for :title, "メール認証" %>
<% content_for :body_bg, 'bg-slate-700' %>

<main class="min-h-dvh flex items-start justify-center px-4 py-10">
  <div class="w-full max-w-md">
    <div class="rounded-3xl overflow-hidden shadow-xl ring-1 ring-black/5 bg-white/95">
      <div class="relative px-6 pt-6 pb-2 text-center">
        <%= link_to "← ホームに戻る", root_path,
            class: "absolute left-6 top-6 text-sm text-slate-600 hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-300 rounded px-1",
            'aria-label': 'ホームに戻る' %>
        <h1 class="text-2xl font-bold text-slate-900">メール認証</h1>
        <p class="mt-2 text-slate-600">
          <%= (session[:verify_email] || "登録メールアドレス") %> に送信された 6桁コードを入力してください。
        </p>

        <%# 開発だけ：今のコードを表示（本番では出ない） %>
        <% if Rails.env.development? && (u = User.find_by(email: session[:verify_email])) && u.confirmation_code.present? %>
          <p class="mt-2 text-xs text-emerald-700 bg-emerald-50 inline-block px-2 py-1 rounded">
            devヒント: 現在のコード <span class="tabular-nums tracking-widest"><%= u.confirmation_code %></span>
          </p>
        <% end %>
      </div>

      <div class="px-6 pb-6">
        <%= form_with url: verify_email_path, method: :post do |f| %>
          <input type="text" name="code" inputmode="numeric" pattern="[0-9]*" maxlength="6"
                 class="mt-3 block w-full text-center tracking-widest text-2xl rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-4 focus:ring-slate-200"
                 placeholder="••••••" autofocus />
          <div class="mt-4">
            <button class="w-full rounded-full bg-slate-900 py-3.5 text-white font-semibold hover:bg-slate-800 focus-visible:ring-4 focus-visible:ring-slate-300">
              確認する
            </button>
          </div>
        <% end %>

        <div class="mt-4 flex items-center justify-between text-sm">
          <%= button_to "コードを再送", resend_verify_email_path, method: :post,
                class: "rounded-full px-4 py-2 bg-slate-100 text-slate-900 hover:bg-white" %>
          <%= link_to "会員登録に戻る", new_user_registration_path, class: "text-slate-600 hover:underline" %>
        </div>

        <% if defined?(@expired) && @expired %>
          <p class="mt-3 text-sm text-amber-700">新しいコードを受け取ったら、最新の6桁を入力してください。</p>
        <% end %>
      </div>
    </div>
  </div>
</main>
