<% content_for :body_bg, 'bg-stone-700' %>
<main class="min-h-dvh flex items-start justify-center px-4 py-10">
  <div class="w-full max-w-md">
    <div class="w-full rounded-3xl overflow-hidden shadow-xl ring-1 ring-black/5 bg-white/95">
      <%= image_tag "auth/login-header.jpg", alt: "", class: "block w-full h-40 sm:h-56 md:h-64 object-cover object-center select-none" %>

      <div class="px-6 pt-6 pb-2 text-center">
        <h1 class="text-3xl font-extrabold tracking-tight text-slate-900">6桁コードの入力</h1>
        <p class="mt-3 text-slate-600"><%= (@email || "登録メール") %> に送信されたコードを入力してください。</p>
      </div>

      <div class="px-6 pb-6">
        <% if defined?(@invalid_code) && @invalid_code %>
          <p class="mb-3 text-sm text-rose-600">コードが正しくありません。もう一度お試しください。</p>
        <% end %>

        <%= form_with url: verify_password_submit_path, method: :post do %>
          <input type="text" name="code" inputmode="numeric" pattern="[0-9]*" maxlength="6"
                 class="mt-3 block w-full text-center tracking-widest text-2xl rounded-xl border border-slate-300 px-4 py-3 focus:outline-none focus:ring-4 focus:ring-slate-200"
                 placeholder="••••••" autofocus />
          <div class="mt-4">
            <button class="w-full rounded-full bg-slate-900 py-3.5 text-white font-semibold hover:bg-slate-800 focus-visible:ring-4 focus-visible:ring-slate-300">
              確認する
            </button>
          </div>
        <% end %>

        <div class="mt-4 flex items-center justify-between text-sm">
          <%= button_to "コードを再送", resend_password_code_path, method: :post,
                class: "rounded-full px-4 py-2 bg-slate-100 text-slate-900 hover:bg-white" %>
          <%= link_to "メール入力に戻る", new_user_password_path, class: "text-slate-600 hover:underline" %>
        </div>

        <%# dev支援（本番では削除） %>
        <% if Rails.env.development? && session[:reset_email].present? %>
          <% u = User.find_by(email: session[:reset_email]) %>
          <% if u&.reset_password_code.present? %>
            <p class="mt-3 text-xs text-emerald-700">devヒント: <%= u.reset_password_code %></p>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</main>
